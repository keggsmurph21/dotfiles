#!/bin/bash

set -euo pipefail

cd "$(dirname $0)"

# move dotfiles to $HOME

__backup_and_link() {
    src="$1"
    tar="$2"
    [ -e "$tar" ] && ./bin/bak "$tar"
    ln -sf "$src" "$tar"
    echo "linked: $tar@ -> $src"
}

for rcfile in ./home/*; do
    basename="$(basename "$rcfile")"
    __backup_and_link "$(pwd)/home/$basename" "$HOME/.$basename"
done

# set up directory structure
git_username="$( (git config --get user.name || true) | sed 's/@.*//g')"
[[ -z "$git_username" ]] || mkdir -p \
        "$HOME/src/$git_username" \
        "$HOME/.local/bin"

# install vim plugins via vundle
vim +PluginInstall

cat <<EOM
> Success! Don't forget to source ~/.bashrc :^)
EOM
