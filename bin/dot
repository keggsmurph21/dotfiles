#!/usr/bin/env python3

import argparse
import os
import subprocess

def run(command):
    proc = subprocess.run(command.split())
    if proc.returncode:
        raise RuntimeError('Nonzero return from command "' + command \
                + '": ' + str(proc.returncode))

os.chdir(os.environ['DOTFILES_DIR'])

parser = argparse.ArgumentParser()
parser.add_argument('command', choices=['push', 'pull', 'status'])
args = parser.parse_args()

if args.command == 'push':
    run('git add --all -N')
    run('git add --update -p')
    try:
        run('git commit -v')
        run('git push')
    except RuntimeError as e:
        print(repr(e))

elif args.command == 'pull':
    run('git pull')

elif args.command == 'status':
    run('git status -s')

