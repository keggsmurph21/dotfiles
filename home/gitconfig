# vim: syntax=gitconfig

[user]
    useConfigOnly = true

[advice]
    detachedHead = false

[grep]
    lineNumber = true

[push]
    default = upstream

[diff]
    mnemonicPrefix = true

[merge]
    tool = vimdiff
    conflictstyle = diff3
    defaultToUpstream = true

[color]
    ui = auto

[pretty]
    line = "%C(auto)%h %<|(80,trunc)%s %C(green)%ad %C(blue)%an%C(auto)%d"
    detail = "%C(auto)%h %s%n  %C(yellow)by %C(blue)%an %C(magenta)<%ae> [%G?] %C(green)%ad%n %C(auto)%d%n"

[credential]
    helper = cache

[log]
    date = local

[lfs]
    smudge = git-lfs smudge -- %f
    process = git-lfs filter-process
    required = true
    clean = git-lfs clean -- %f

[alias]
    a       = add
    af      = add -N
    ap      = add -p
    au      = add -u
    aup     = add -up
    ac      = ! git add -up && git commit -v

    back    = ! git-nav back

    bd      = branch -D
    bl      = branch --all -vv
    bname   = ! git isempty && echo __NO_HEAD__ || git rev-parse --abbrev-ref HEAD
    br      = checkout -b

    c       = commit -v
    ca      = commit -v --amend
    cm      = ! cat | git commit -F -

    co      = checkout

    commits = log --pretty=format:"%H"

    conf    = config --edit

    count   = rev-list --count HEAD

    cp      = cherry-pick

    d       = diff
    ds      = diff --stat
    dv      = diff -vv
    dw      = diff --color-words
    dc      = diff --cached
    dcs     = diff --cached --stat
    dcv     = diff --cached -vv
    dcw     = diff --cached --color-words

    dir     = rev-parse --show-toplevel

    # drop the most recent commit from the local tree
    # NB: this can be undone by running
    #   $ git reflog # get the $sha
    #   $ git reset --hard $sha
    drop    = reset --hard HEAD~1

    f       = fetch
    fa      = fetch --all -p

    fw      = ! git-nav fw

    graph   = log --graph

    history = ! git-nav show

    isempty = ! test $(git bl | wc -l) -eq 0

    null    = hash-object -t tree /dev/null

    l       = log
    lol     = log --pretty=line
    lp      = log -p
    lpw     = log -p --color-words
    lstat   = log --stat
    last    = log -p -1 HEAD

    lsm     = ! git-ls-mtime

    # merge-resolve: Open all files with merge conflicts in
    #   an editor and automatically highlight the conflicts
    mr      = ! $EDITOR "$(git unmerged)" '+/\\(<\\|=\\||\\|>\\)\\{7\\}'

    nav     = ! git-nav

    ra      = remote add

    ri      = rebase -i

    # get a "canonical" repo name
    rname   = ! basename "$(git root)"

    # get the "root" git dir, even if we're in a (managed) worktree
    root    = "! __git_root() { \
                    local repo="$(git dir)"; \
                    if [ -L "$repo/.wt/root" ]; then \
                        repo="$(readlink "$repo/.wt/root")"; \
                    fi; \
                    echo "$repo"; \
                }; __git_root"

    s       = status -sb

    sm      = submodule

    tracked = ! git diff --stat "$(git null)"

    uncommit= reset --soft HEAD~1 --

    unmerged= ! git status -sb | sed -nE 's/^UU (.*)$/\\1/p'

    unstage = reset HEAD --

    url     = ls-remote --get-url

[core]
    excludesfile = ~/.gitignore

[include]
    # local customization
    path    = ~/.gitconfig.local
